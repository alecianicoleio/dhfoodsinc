var ptb_extra_geocoder;
function ptb_extra_map_init(p){function f(c,a,d){ptb_extra_geocoder||(ptb_extra_geocoder=new google.maps.Geocoder);var b={};b[a]=c;ptb_extra_geocoder.geocode(b,function(b,a){"OK"!==a&&(b[0]=null);d(b[0])})}function h(h,a,d,b,f,e,g,l,m,k){b?(b.geometry.viewport?h.fitBounds(b.geometry.viewport):(h.setCenter(b.geometry.location),h.setZoom(17)),b.icon?a.setIcon({url:b.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}):
a.setIcon(),a.setPosition(k?k:b.geometry.location),a.setVisible(!0),m||(c.trim(d.val())?e=c.trim(d.val()).replace(/(?:\r\n|\r|\n)/ig,"<br />"):(b.address_components&&(e=[b.address_components[0]&&b.address_components[0].short_name||"",b.address_components[1]&&b.address_components[1].short_name||"",b.address_components[2]&&b.address_components[2].short_name||""].join(" ")),d.val(e),e="<div><strong>"+b.name+"</strong><br>"+e)),g.setContent(e),g.open(h,a),k||l.val(b.geometry.location.lat()+", "+b.geometry.location.lng()),
f.val(JSON.stringify({place:b.place_id,location:k?k:b.geometry.location}))):(f.val(""),l.val(""),a.setVisible(!1))}var c=jQuery;c(".ptb_post_cmb_item_map").each(function(){var r={center:new google.maps.LatLng(43.67023,-79.38676),zoom:13},a=c(this).prop("id"),d=new google.maps.Map(document.getElementById("ptb_extra_"+a+"_canvas"),r),b=document.getElementById("ptb_extra_"+a+"_location"),r=document.getElementById("ptb_extra_"+a+"_select");d.controls[google.maps.ControlPosition.TOP_LEFT].push(b);d.controls[google.maps.ControlPosition.TOP_LEFT].push(r);
var q=new google.maps.places.Autocomplete(b);q.bindTo("bounds",d);var e=new google.maps.InfoWindow,g=new google.maps.Marker({map:d,anchorPoint:new google.maps.Point(0,-29),draggable:!0,animation:google.maps.Animation.DROP}),l=!1,m=c("#ptb_extra_"+a+"_place"),k=c("#ptb_extra_"+a+"_info"),n=c("#ptb_extra_"+a+"_lat");if(a=m.val())if(a=c.parseJSON(a))a.location?(g.setPosition({lat:a.location.lat,lng:a.location.lng}),d.setCenter({lat:a.location.lat,lng:a.location.lng}),c.trim(k.val())&&(e.setContent(c.trim(k.val())),
e.open(d,g)),n.val(a.location.lat+", "+a.location.lng)):a.place&&(new google.maps.places.PlacesService(d)).getDetails({placeId:a.place},function(a,d){d===google.maps.places.PlacesServiceStatus.OK&&(l=a,google.maps.event.trigger(q,"place_changed",p),a.formatted_address?c(b).val(a.formatted_address):c(b).val(a.name))});google.maps.event.addListener(g,"dragend",function(){n.val(g.getPosition().lat()+", "+g.getPosition().lng())});google.maps.event.addListener(q,"place_changed",function(a){e.close();g.setVisible(!1);
var t="";if(l)a=l,t=c.trim(k.val()),l=!1;else{var p=c.trim(c(b).val());if(""!==p){if(a=a?!1:q.getPlace(),!a||!a.geometry){f(p,"address",function(a){a&&a.geometry?h(d,g,k,a,m,t,e,n,l):alert("Autocomplete's returned place contains no geometry")});return}}else{h(d,g,k,"",m,t,e,n,l);return}}h(d,g,k,a,m,t,e,n,l)});google.maps.event.addListener(g,"click",function(){e.open(d,g)});google.maps.event.addDomListener(b,"keydown",function(a){13===a.keyCode&&event.preventDefault()});n.on("change",function(){var a=
c.trim(c(this).val());""!==a?(a=a.split(","),a[1]&&(a={lat:parseFloat(c.trim(a[0])),lng:parseFloat(c.trim(a[1]))},f(a,"location",function(f){f&&f.geometry?(c(b).val(f.formatted_address),h(d,g,k,f,m,"",e,n,!1,a)):alert("Autocomplete's returned place contains no geometry")}))):h(d,g,k,"",m,"",e,n,!1)});c(r).change(function(){q.setTypes([c(this).val()])});k.keyup(function(){var a=c.trim(c(this).val()).replace(/(?:\r\n|\r|\n)/ig,"<br />");e.setContent(a)})})}
(function(p){p(document).on("ptb_metabox_create_map",function(f){}).on("ptb_add_metabox_map",function(f){return{}}).on("ptb_metabox_save_map",function(f){}).on("ptb_post_cmb_map_body_handle",function(f){}).ready(function(){if(0<p(".ptb_post_cmb_item_map").length)if("object"!==typeof google||"object"!==typeof google.maps||"undefined"===typeof google.maps.places){"object"===typeof google&&null!==google&&"object"===typeof google.maps&&"undefined"===typeof google.maps.places&&(google.maps=null);var f=
"//maps.googleapis.com/maps/api/js?v=3&libraries=places&callback=ptb_extra_map_init&language="+ptb_extra.lng+"&key="+ptb_extra.map_key,h=document.createElement("script");h.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(h);h.async=!0;h.src=f}else ptb_extra_map_init()})})(jQuery);
